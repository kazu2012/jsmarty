<?xml version="1.0" encoding="UTF-8"?>
<project name="JSmarty" default="main" basedir="../">

	<property name="version" value="0.2.0" />

	<!-- Directories -->
	<property name="src" value="src" />
	<property name="lib" value="lib" />
	<property name="tmp" value="Temp/JSmarty" />

	<target name="build">
		<mkdir dir="${lib}" />
		<mkdir dir="${tmp}" />
		<concat destfile="${tmp}/JSmarty.js">
			<filelist dir="${src}" files="JSmarty.js" />
			<filelist dir="${src}/JSmarty" files="Browser.js,Utility.js,System.js,Plugin.js" />
		</concat>
		<concat destfile="${tmp}/JSmarty/Compiler.js">
			<filelist dir="${src}/JSmarty" files="Compiler.js,Context.js" />
			<filelist dir="${src}/JSmarty/Compiler" files="__MODULE__.js,__STRING__.js,__NOTEXT__.js" />
			<filelist dir="${src}/JSmarty/Compiler" files="Foreach.js,Foreachelse.js" />
			<filelist dir="${src}/JSmarty/Compiler" files="Section.js,Sectionelse.js" />
			<filelist dir="${src}/JSmarty/Compiler" files="Ldelim.js,Rdelim.js" />
		</concat>
		<copy todir="${lib}" overwrite="Yes" preservelastmodified="true">
			<fileset dir="${src}" />
			<filterset><filter token="version" value="${version}" /></filterset>
		</copy>
		<move file="${tmp}/JSmarty.js" tofile="${lib}/JSmarty.js">
			<filterset><filter token="version" value="${version}" /></filterset>
		</move>
		<move file="${tmp}/JSmarty/Compiler.js" tofile="${lib}/JSmarty/Compiler.js">
			<filterset><filter token="version" value="${version}" /></filterset>
		</move>
		<delete dir="${lib}/JSmarty" excludes="Compiler.js" />
		<delete dir="${lib}/JSmarty/Compiler" />
		<delete dir="${tmp}" />
	</target>

	<target name="main" depends="build">
		<mkdir dir="${tmp}" />
		<copy todir="${tmp}/${lib}"><fileset dir="${lib}" /></copy>
		<copy todir="${tmp}/samples"><fileset dir="samples" /></copy>
		<zip destfile="JSmarty-${version}.zip" basedir="Temp" />
		<tar destfile="JSmarty-${version}.tgz" basedir="Temp" compression="gzip" />
		<delete dir="Temp" />
	</target>

</project>