<?xml version="1.0" encoding="UTF-8"?>
<project name="JSmarty" default="main" basedir="../">

	<property name="version" value="0.4.0" />
	<taskdef name="yuic" classname="YUICTask" /> 

	<!-- Directories -->
	<property name="src" value="src" />
	<property name="lib" value="lib" />
	<property name="tmp" value="Temp/JSmarty" />
	<property name="dist" value="dist" />

	<!-- Target :: build -->
	<target name="build">
		<mkdir dir="${lib}" />
		<mkdir dir="${tmp}" />
		<concat destfile="${tmp}/JSmarty.js">
			<filelist dir="${src}" files="JSmarty.js" />
			<filelist dir="${src}/JSmarty" files="Buffer.js,Storage.js,Error.js,System.js,Plugin.js,History.js,Browser.js" />
		</concat>
		<concat destfile="${tmp}/JSmarty/Compiler.js">
			<filelist dir="${src}/JSmarty" files="Compiler.js" />
			<filelist dir="${src}/JSmarty/Compiler" files="Context.js,__MODULE__.js,define.js" />
		</concat>
		<copy todir="${lib}" overwrite="Yes" preservelastmodified="true">
			<fileset dir="${src}" />
			<filterset><filter token="version" value="${version}" /></filterset>
		</copy>
		<move file="${tmp}/JSmarty.js" tofile="${lib}/JSmarty.js">
			<filterset><filter token="version" value="${version}" /></filterset>
		</move>
		<move file="${tmp}/JSmarty/Compiler.js" tofile="${lib}/JSmarty/Compiler.js">
			<filterset><filter token="version" value="${version}" /></filterset>
		</move>
		<delete dir="${lib}/JSmarty" excludes="Compiler.js" />
		<delete dir="${lib}/JSmarty/Compiler" />
		<delete dir="${tmp}" />
	</target>

	<!-- Target :: main -->
	<target name="main" depends="build">
		<mkdir dir="${tmp}" />
		<mkdir dir="${dist}" />
		<yuic todir="${tmp}/${lib}"><fileset dir="${lib}" /></yuic>
		<copy todir="${tmp}/samples"><fileset dir="samples" /></copy>
		<zip destfile="${dist}/JSmarty-${version}.zip" basedir="Temp" />
		<tar destfile="${dist}/JSmarty-${version}.tgz" basedir="Temp" compression="gzip" />
		<delete dir="Temp" />
	</target>

</project>